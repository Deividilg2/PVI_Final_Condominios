@model PVI_Final_Condominios.Models.GestionarCasasModels
@{
    ViewBag.Title = "CrearCasas";
}

<h2>ModificarCasas</h2>

<form method="post" id="casasform" action="/GestionarCasas/CrearCasas">
    @Html.HiddenFor(model => model.idCasa)
    <div class="mb-3">
        <label class="form-label" for="nombreCasa">Casa</label>
        @Html.TextBoxFor(model => model.nombreCasa, new { @class = "form-control", @disabled = "disabled", maxlength = "50", placeholder = "Nombre de la casa" })
    </div>
    <div class="mb-3">
        <label class="form-label" for="metrosCuadrados">Metros Cuadrados</label>
        @Html.TextBoxFor(model => model.metrosCuadrados, new { @class = "form-control", @disabled = "disabled", step = "0.01", min = "0" })
    </div>
    <div class="mb-3">
        <label class="form-label" for="numeroHabitaciones">Número de habitaciónes</label>
        @Html.TextBoxFor(model => model.numeroHabitaciones, new { @class = "form-control",  max = "8", min = "1" })
    </div>
    <div class="mb-3">
        <label class="form-label" for="numeroBannos">Número de baños</label>
        @Html.TextBoxFor(model => model.numeroBannos, new { @class = "form-control", max = "4", min = "1" })
    </div>
    <div class="mb-3">
        <label class="form-label" for="metrosCuadrados">Metros Cuadrados</label>
        @Html.TextBoxFor(model => model.metrosCuadrados, new { @class = "form-control", @disabled = "disabled" })
    </div>
    <div class="mb-3">
        <label class="form-label" for="idPersona">Cliente</label>
        @Html.TextBoxFor(model => model.idPersona, new { @class = "form-control", @disabled = "disabled" })
    </div>
    <div class="mb-3">
        <label class="form-label" for="fechaConstruccion">Fecha de construcción</label>
        @Html.TextBoxFor(model => model.fechaConstruccion, new { @class = "form-control", @disabled = "disabled" })
    </div>
    <input type="submit" value="Guardar" id="Guardar" class="btn btn-primary" />
    <input type="button" value="Inactivar" id="Inactivar" class="btn btn-danger" />
    <a href="~/GestionarCasas/ConsultarCasas" class="btn btn-dark">Regresar</a>
</form>

@section Scripts{
    @Scripts.Render("~/bundles/jqueryval")
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script type="text/javascript">

        $(document).ready(function () {

            $("#casasform").on("submit", function (e) {
                e.preventDefault(); // Evitar la acción predeterminada del formulario

                var form = $(this);
                var actionUrl = form.attr('action'); // Obtiene la URL del formulario
                var formData = form.serialize(); // Serializa los datos del formulario

                // Enviar los datos mediante AJAX
                $.post(actionUrl, formData, function (response) {
                    // Mostrar el mensaje de SweetAlert2 basado en la respuesta
                    Swal.fire({
                        title: "Resultado",
                        text: response, // Respuesta enviada por el servidor
                        icon: response.includes("éxito") ? "success" : "error", // Ícono dinámico según el resultado
                        confirmButtonText: "Aceptar"
                    }).then(() => {
                        if (response.includes("éxito")) {
                            // Redirigir o recargar en caso de éxito
                            window.location.href = "/GestionarCasas/ConsultarCasas";
                        }
                    });
                }).fail(function () {
                    // En caso de error en la solicitud
                    Swal.fire({
                        title: "Error",
                        text: "No se pudo procesar la solicitud. Intente nuevamente.",
                        icon: "error",
                        confirmButtonText: "Aceptar"
                    });
                });
            });


            var idcasa = @((this.Model != null) ? this.Model.idCasa : 0);
             // Manejar la inactivación de un servicio
            $("#Inactivar").click(function () {
                Swal.fire({
                    title: "¿Estás seguro?",
                    text: "Esta acción inactivará la casa.",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonText: "Sí, inactivar",
                    cancelButtonText: "Cancelar"
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.post("/GestionarCasas/InactivarCasa", { idcasa: idcasa }) // Pasar ID como parámetro
                            .done(function (response) {
                                Swal.fire({
                                    title: "Resultado",
                                    text: response,
                                    icon: response.includes("éxito") ? "success" : "error",
                                    confirmButtonText: "Aceptar"
                                }).then(() => {
                                    if (response.includes("éxito")) {
                                        // Recargar la página o redirigir
                                        window.location.href = "/GestionarCasas/ConsultarCasas";                                    }
                                });
                            }).fail(function () {
                                Swal.fire({
                                    title: "Error",
                                    text: "No se pudo inactivar la casa. Intente nuevamente.",
                                    icon: "error",
                                    confirmButtonText: "Aceptar"
                                });
                            });
                    }
                });
            });


        });

    </script>
}
